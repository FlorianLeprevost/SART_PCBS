---
title: "Data analysis"
author: "Florian Leprevost"
date: "21/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(root.dir = 'SART_PCBS')

```

# 1. Objectives
List of data wrangling and analysis to do:

- [ ] Putting it in dataframes
  - [ ] Read .xpd files with R
  - [ ] Change .txt files into .csv before reading them
  
- [ ] Augment the dataframe with:
  - [ ] probes results (need to be converted from key value to numbers --> 1-9 = 49-57)
  - [ ] reaction time variability in the last 8 trials (see [Bastian & Sackur 2013](https://www.frontiersin.org/articles/10.3389/fpsyg.2013.00573/full) )
  - [ ] mean reaction time in the 8 preceding trials
  
- Try and reproduce Seli's results
  - [ ] calculate mindwandering rate by type
    - (number of deliberate mindwandering reports on total number of reports reports)
  - [ ] bin categories to match their data 
    - deliberate or spontaneous mind wandering = controlled (6-9) or uncontrolled (1-4) unrelated thoughts (1-4)
  - [ ] mixed ANOVA (with difficulty as between subject, mind-wandering type as within subject, and rate as dependent variable) 
  
- Other tests
  - [ ] Regression of reaction time variability by control * relatedness
  - [ ] PCA? 
  - [ ] MVPA?
  

#Dataframe
Need the tidyverse

```{r}
library(tidyverse)
```
read xpd with function from documentation
```{r echo=false}
setwd('C:/Users/install/SART_PCBS')
source('expyriment_data.R')
```

```{r}
dtf= read.expyriment.data("data", "SART_task_easy")
```


change txt files (probe data) in csv before transforming them in dataframes

```{r}
files <- list.files(pattern="*.txt")
newfiles <- gsub(".txt$", ".csv", files)
file.rename(files, newfiles)
```

```{r}
#get file names
files= list.files(pattern=".csv$")
files_easy = grep("^probe_data_easy", files, value=T)
files_hard = grep("^probe_data_easy", files, value=T, invert=T)


#get the difficulty indice and the subject id
# difficulty=list()
# subject_id=list()
# 
# for (el in files) {
#   if (substr(el, 12,15) == "easy")  {
#     difficulty[length(difficulty)+1]=0
#     subject_id[length(subject_id)+1]=substr(el, 16,16)
#     
#   }else{
#     difficulty[length(difficulty)+1]=1
#     subject_id[length(subject_id)+1]=substr(el, 11,11)
#   }
# }

#read files
several_dtf = lapply(files, read.csv)
#add missing parameters to dataframes
for (ind in length(several_dtf)){
  several_dtf[ind] <- several_dtf[ind] %>% 
    mutate("subject_id"=pull(subject_id[ind])) %>% 
    mutate("difficulty"=pull(difficulty[ind]))
}
#bind dataframes
dtf_probes = do.call(rbind, several_dtf)
#add rtv

  
  
```



